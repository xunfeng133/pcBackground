(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31463e34"],{"3cf7":function(t,e,n){},"81d9":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{position:"relative"},attrs:{id:"container"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],staticStyle:{"z-index":"10000",width:"160px",position:"absolute",height:"40px",top:"20px",left:"10px"},attrs:{type:"text",placeholder:"请输入周边关键字"},domProps:{value:t.key},on:{input:function(e){e.target.composing||(t.key=e.target.value)}}}),n("button",{staticStyle:{"z-index":"10000",position:"absolute",height:"40px",top:"20px",left:"200px",width:"60px"},attrs:{type:"button"},on:{click:t.searchAround}},[t._v("搜索")])]),n("div",{staticClass:"points-wrapper"},[n("el-form",{attrs:{"label-width":"100px"}},[n("div",[n("div",{staticClass:"title"},[t._v("Tips:请点击地图拾取地点")]),t._l(t.points,function(e,a){return n("el-row",{staticStyle:{padding:"5px 0"}},[n("el-col",{attrs:{span:6}},[n("el-form-item",{attrs:{label:"地点名称："}},[n("el-input",{attrs:{size:"small"},model:{value:e.name,callback:function(n){t.$set(e,"name",n)},expression:"item.name"}})],1)],1),n("el-col",{attrs:{span:6}},[n("el-form-item",{attrs:{label:"经纬度："}},[n("div",[t._v(t._s(e.latLng.lat.toFixed(5))+","+t._s(e.latLng.lng.toFixed(5)))])])],1),n("el-col",{attrs:{span:4}},[n("el-form-item",{attrs:{label:"距离："}},[n("div",[t._v(t._s(Math.ceil(t.computeDistance(e.latLng.lat,e.latLng.lng)))+"米")])])],1),n("el-col",{attrs:{span:6}},[n("el-form-item",{attrs:{label:"地点分类"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.pointType,callback:function(n){t.$set(e,"pointType",n)},expression:"item.pointType"}},t._l(t.pointTypeOptions,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1),n("el-col",{attrs:{span:2}},[n("div",{staticStyle:{padding:"0 10px"}},[n("el-button",{attrs:{size:"small",type:"danger",icon:"el-delete"},on:{click:function(n){return t.removeSchoolPoint(e,a)}}},[t._v("删除")])],1)])],1)})],2)])],1),n("div",{staticStyle:{"text-align":"center",padding:"40px 0"}},[n("el-button",{attrs:{size:"medium"},on:{click:t.saveAndComplete}},[t._v("保存完成")]),n("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.saveAndNext}},[t._v("保存并下一步")]),n("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.next}},[t._v("下一步")])],1)])},o=[],i=(n("7f7f"),n("f803")),r={data:function(){return{map:null,markerLayer:null,markers:[],id:1,key:"",marker2:void 0,points:[],houseLatlng:{lat:"",lng:""},pointTypeOptions:[{label:"交通",value:1},{label:"教育",value:2},{label:"医疗",value:3},{label:"生活",value:4},{label:"休闲",value:5}]}},mounted:function(){this.initMap()},methods:{initMap:function(){var t=this,e=new TMap.LatLng(22.535512,114.028745);this.$route.query.lat&&(e=new TMap.LatLng(this.$route.query.lat,this.$route.query.lng)),this.$set(this.houseLatlng,"lat",e.lat),this.$set(this.houseLatlng,"lng",e.lng);var n=e,a=new TMap.Map(document.getElementById("container"),{center:n,zoom:16});this.map=a;document.getElementById("mapContainer");var o=new TMap.InfoWindow({map:a,position:a.getCenter()}).close();a.on("click",function(e){var n=e.poi;n?(t.points.push(Object.assign({id:t.id,pointType:""},n)),t.markerLayer.add({position:n.latLng,id:t.id++})):o.close()}),this.initMarkerLayer(a),this.createHouseMarker(e.lat,e.lng)},initMarkerLayer:function(t){this.markerLayer=new TMap.MultiMarker({id:"marker-layer",map:t})},searchAround:function(){console.log("ok");var t=["https://apis.map.qq.com/ws/place/v1/search","?boundary=nearby(22.535512,114.028745,1000,0)","&keyword=".concat(this.key),"&page_size=10&page_index=1&orderby=_distance","&output=jsonp&callback=cb","&key=6NKBZ-2OL3G-OP7QZ-I2KDF-CZGKT-HOFL5"].join("");this.jsonp_request(t)},jsonp_request:function(t){this.$jsonp(t).then(function(t){console.log(t)}).catch(function(t){console.log(t)})},createHouseMarker:function(t,e){this.marker2||(this.marker2=new TMap.MultiMarker({id:"marker-layer2",map:this.map,styles:{marker:new TMap.MarkerStyle({width:25,height:35,anchor:{x:16,y:32},src:"http://8.130.26.25:7005/file/20210507/e6fabe0608b34657b10a4459f228e928.png"})},geometries:[{id:"demo",styleId:"marker",position:new TMap.LatLng(t,e),properties:{title:"marker"}}]}))},computeDistance:function(t,e){var n=new TMap.LatLng(t,e),a=new TMap.LatLng(this.houseLatlng.lat,this.houseLatlng.lng),o=[n,a];return TMap.geometry.computeDistance(o)},removeSchoolPoint:function(t){this.markerLayer.remove(t.id),this.points.splice(t,1)},submit:function(t){for(var e=this,n=[],a=0;a<this.points.length;a++){var o=this.points[a];if(""===o.pointType)return alert("建筑类型不能为空"),0;n.push({buildingName:o.name,lat:o.latLng.lat,lng:o.latLng.lng,type:o.pointType,distance:Math.ceil(this.computeDistance(o.latLng.lat,o.latLng.lng))})}if(0===n.length)return alert("请在地图上选择地点"),0;Object(i["e"])(this.$route.query.houseId,n).then(function(n){0===n.code?1===t?e.$router.push("/house/addHistory"):e.$emit("changeActive",3):alert(n.msg)})},saveAndComplete:function(){this.submit(1)},saveAndNext:function(){this.submit(2)},next:function(){this.$emit("changeActive",3)}}},s=r,u=(n("9599"),n("2877")),l=Object(u["a"])(s,a,o,!1,null,"5b004d5e",null);e["default"]=l.exports},9599:function(t,e,n){"use strict";var a=n("3cf7"),o=n.n(a);o.a},f803:function(t,e,n){"use strict";n.d(e,"l",function(){return r}),n.d(e,"i",function(){return s}),n.d(e,"o",function(){return u}),n.d(e,"b",function(){return l}),n.d(e,"c",function(){return c}),n.d(e,"j",function(){return p}),n.d(e,"h",function(){return d}),n.d(e,"f",function(){return h}),n.d(e,"e",function(){return m}),n.d(e,"d",function(){return f}),n.d(e,"g",function(){return g}),n.d(e,"k",function(){return y}),n.d(e,"n",function(){return v}),n.d(e,"a",function(){return b}),n.d(e,"m",function(){return k});var a=n("a27e"),o=n("4328"),i=n.n(o);function r(t){return Object(a["a"])({url:"/house/estate/admin/getInsertHistory4",method:"get",params:t})}function s(t,e){return Object(a["a"])({url:"/house/estate/getEstate/"+t,method:"get",params:e})}function u(t){return a["a"].post("house/estate/updatehouse",i.a.stringify(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function l(t,e){return Object(a["a"])({url:"house/estate/savehouse?clientSales.owner="+e,method:"post",params:t})}function c(t,e){return Object(a["a"])({url:"/house/estate/admin/savehouse?clientSales.owner="+e,method:"post",params:t})}function p(t){return Object(a["a"])({url:"/house/estate/admin/getInsertHistory",method:"get",params:t})}function d(t){return Object(a["a"])({url:"/house/estate/auditList",method:"get",params:t})}function h(t){return Object(a["a"])({url:"/house/estate/audit",method:"post",params:t})}function m(t,e){return Object(a["a"])({url:"/house/estate/addNearby/".concat(t),method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function f(t){return Object(a["a"])({headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"post",url:"/house/estate/extraInfo",data:t})}function g(t,e){return Object(a["a"])({method:"post",url:"/house/estate/batchAddHouseRes/".concat(t),data:e})}function y(){return Object(a["a"])({method:"get",url:"/house/estate/area"})}function v(t){return Object(a["a"])({method:"get",url:"/house/estate/searchEstate?key="+t})}function b(t){return Object(a["a"])({method:"post",url:"/house/estate/addEstate",data:i.a.stringify(t)})}function k(t){return Object(a["a"])({method:"post",url:"/house/estate/postAudit/".concat(t)})}}}]);