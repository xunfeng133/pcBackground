(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1640b91b"],{"38b4":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"1000px","background-color":"#ffffff",margin:"10px auto"}},[a("el-steps",{staticStyle:{"margin-top":"20px"},attrs:{active:e.active,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:"基本信息"}}),a("el-step",{attrs:{title:"周边配置"}}),a("el-step",{attrs:{title:"历史成交价"}}),a("el-step",{attrs:{title:"房源图片"}})],1),1===e.active?a("basic-form",{on:{changeActive:e.setActive}}):e._e(),2===e.active?a("around-form",{on:{changeActive:e.setActive}}):e._e(),3===e.active?a("history-deal-form",{on:{changeActive:e.setActive}}):e._e(),4===e.active?a("house-res-form"):e._e()],1)},n=[],s=(a("f803"),a("8c05")),l=a("81d9"),o=a("5528"),r=a("bf5d"),c={components:{BasicForm:s["default"],AroundForm:l["default"],HistoryDealForm:o["default"],HouseResForm:r["default"]},data:function(){return{dialog:{width:"400px",formLabelWidth:"120px"},active:1}},methods:{setActive:function(e){this.active=e},closeDialog:function(){this.$emit("closeDialog")}}},u=c,p=(a("7a0a"),a("2877")),d=Object(p["a"])(u,i,n,!1,null,"f77dde60",null);t["default"]=d.exports},"3cf7":function(e,t,a){},5528:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{staticStyle:{padding:"10px 0"},attrs:{"label-width":"100px"}},e._l(e.deals,function(t,i){return a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{prop:"development",label:"成交日期:"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",size:"medium",placeholder:"选择日期"},model:{value:t.time,callback:function(a){e.$set(t,"time",a)},expression:"item.time"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"成交价格"}},[a("el-input",{attrs:{size:"medium"},model:{value:t.amount,callback:function(a){e.$set(t,"amount",a)},expression:"item.amount"}},[a("template",{slot:"append"},[e._v("万")])],2)],1)],1),a("el-col",{attrs:{span:8}},[a("el-button",{attrs:{icon:"el-icon-add",type:"primary",size:"medium"},on:{click:function(t){return e.addOneDeal(i)}}},[e._v("添加")])],1)],1)}),1),a("div",{staticStyle:{"text-align":"center",padding:"40px 0"}},[a("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.saveAndComplete}},[e._v("保存完成")]),a("el-button",{attrs:{size:"medium"},on:{click:function(t){return e.next()}}},[e._v("下一步")]),a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.saveAndNext}},[e._v("保存并下一步")])],1)],1)},n=[],s=a("f803"),l={data:function(){return{deals:[{time:"",amount:""}]}},methods:{saveAndComplete:function(){this.submit(1)},saveAndNext:function(){this.submit(2)},next:function(){this.$emit("changeActive",4)},submit:function(e){var t=this;0===this.deals.length&&alert("历史成交记录不能为空");for(var a=0;a<this.deals.length;a++){var i=this.deals[a];if(!i.amount||!i.time)return alert("字段不能为空"),0}var n=new FormData;n.append("housePropertyId",this.$route.query.houseId),n.append("deals",JSON.stringify(this.deals)),Object(s["d"])(n).then(function(a){0===a.code?1===e?(alert("添加成功"),t.$router.push("/house/addHistory")):t.$emit("changeActive",4):alert(a.msg)})},addOneDeal:function(e){this.deals.splice(e+1,0,{dealDate:"",dealAmount:""})}}},o=l,r=a("2877"),c=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=c.exports},"7a0a":function(e,t,a){"use strict";var i=a("d408"),n=a.n(i);n.a},"81d9":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{position:"relative"},attrs:{id:"container"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.key,expression:"key"}],staticStyle:{"z-index":"10000",width:"160px",position:"absolute",height:"40px",top:"20px",left:"10px"},attrs:{type:"text",placeholder:"请输入周边关键字"},domProps:{value:e.key},on:{input:function(t){t.target.composing||(e.key=t.target.value)}}}),a("button",{staticStyle:{"z-index":"10000",position:"absolute",height:"40px",top:"20px",left:"200px",width:"60px"},attrs:{type:"button"},on:{click:e.searchAround}},[e._v("搜索")])]),a("div",{staticClass:"points-wrapper"},[a("el-form",{attrs:{"label-width":"100px"}},[a("div",[a("div",{staticClass:"title"},[e._v("Tips:请点击地图拾取地点")]),e._l(e.points,function(t,i){return a("el-row",{staticStyle:{padding:"5px 0"}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"地点名称："}},[a("el-input",{attrs:{size:"small"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"经纬度："}},[a("div",[e._v(e._s(t.latLng.lat.toFixed(5))+","+e._s(t.latLng.lng.toFixed(5)))])])],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"距离："}},[a("div",[e._v(e._s(Math.ceil(e.computeDistance(t.latLng.lat,t.latLng.lng)))+"米")])])],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"地点分类"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.pointType,callback:function(a){e.$set(t,"pointType",a)},expression:"item.pointType"}},e._l(e.pointTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),a("el-col",{attrs:{span:2}},[a("div",{staticStyle:{padding:"0 10px"}},[a("el-button",{attrs:{size:"small",type:"danger",icon:"el-delete"},on:{click:function(a){return e.removeSchoolPoint(t,i)}}},[e._v("删除")])],1)])],1)})],2)])],1),a("div",{staticStyle:{"text-align":"center",padding:"40px 0"}},[a("el-button",{attrs:{size:"medium"},on:{click:e.saveAndComplete}},[e._v("保存完成")]),a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.saveAndNext}},[e._v("保存并下一步")]),a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.next}},[e._v("下一步")])],1)])},n=[],s=(a("7f7f"),a("f803")),l={data:function(){return{map:null,markerLayer:null,markers:[],id:1,key:"",marker2:void 0,points:[],houseLatlng:{lat:"",lng:""},pointTypeOptions:[{label:"交通",value:1},{label:"教育",value:2},{label:"医疗",value:3},{label:"生活",value:4},{label:"休闲",value:5}]}},mounted:function(){this.initMap()},methods:{initMap:function(){var e=this,t=new TMap.LatLng(22.535512,114.028745);this.$route.query.lat&&(t=new TMap.LatLng(this.$route.query.lat,this.$route.query.lng)),this.$set(this.houseLatlng,"lat",t.lat),this.$set(this.houseLatlng,"lng",t.lng);var a=t,i=new TMap.Map(document.getElementById("container"),{center:a,zoom:16});this.map=i;document.getElementById("mapContainer");var n=new TMap.InfoWindow({map:i,position:i.getCenter()}).close();i.on("click",function(t){var a=t.poi;a?(e.points.push(Object.assign({id:e.id,pointType:""},a)),e.markerLayer.add({position:a.latLng,id:e.id++})):n.close()}),this.initMarkerLayer(i),this.createHouseMarker(t.lat,t.lng)},initMarkerLayer:function(e){this.markerLayer=new TMap.MultiMarker({id:"marker-layer",map:e})},searchAround:function(){console.log("ok");var e=["https://apis.map.qq.com/ws/place/v1/search","?boundary=nearby(22.535512,114.028745,1000,0)","&keyword=".concat(this.key),"&page_size=10&page_index=1&orderby=_distance","&output=jsonp&callback=cb","&key=6NKBZ-2OL3G-OP7QZ-I2KDF-CZGKT-HOFL5"].join("");this.jsonp_request(e)},jsonp_request:function(e){this.$jsonp(e).then(function(e){console.log(e)}).catch(function(e){console.log(e)})},createHouseMarker:function(e,t){this.marker2||(this.marker2=new TMap.MultiMarker({id:"marker-layer2",map:this.map,styles:{marker:new TMap.MarkerStyle({width:25,height:35,anchor:{x:16,y:32},src:"http://8.130.26.25:7005/file/20210507/e6fabe0608b34657b10a4459f228e928.png"})},geometries:[{id:"demo",styleId:"marker",position:new TMap.LatLng(e,t),properties:{title:"marker"}}]}))},computeDistance:function(e,t){var a=new TMap.LatLng(e,t),i=new TMap.LatLng(this.houseLatlng.lat,this.houseLatlng.lng),n=[a,i];return TMap.geometry.computeDistance(n)},removeSchoolPoint:function(e){this.markerLayer.remove(e.id),this.points.splice(e,1)},submit:function(e){for(var t=this,a=[],i=0;i<this.points.length;i++){var n=this.points[i];if(""===n.pointType)return alert("建筑类型不能为空"),0;a.push({buildingName:n.name,lat:n.latLng.lat,lng:n.latLng.lng,type:n.pointType,distance:Math.ceil(this.computeDistance(n.latLng.lat,n.latLng.lng))})}if(0===a.length)return alert("请在地图上选择地点"),0;Object(s["e"])(this.$route.query.houseId,a).then(function(a){0===a.code?1===e?t.$router.push("/house/addHistory"):t.$emit("changeActive",3):alert(a.msg)})},saveAndComplete:function(){this.submit(1)},saveAndNext:function(){this.submit(2)},next:function(){this.$emit("changeActive",3)}}},o=l,r=(a("9599"),a("2877")),c=Object(r["a"])(o,i,n,!1,null,"5b004d5e",null);t["default"]=c.exports},9599:function(e,t,a){"use strict";var i=a("3cf7"),n=a.n(i);n.a},bf5d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"20px"}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"房源图片"}},[a("el-upload",{attrs:{action:e.baseUrl+"/file/file",accept:"image/jpeg,image/png","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"before-upload":e.beforeAvatarUpload,"on-success":function(t,a,i){e.handleSuccess(t,a,i,1)},"on-remove":function(t,a){e.handleRemove(t,a,1)}}},[a("i",{staticClass:"el-icon-plus"})])],1),a("el-form-item",{attrs:{label:"户型图"}},[a("el-upload",{attrs:{action:e.baseUrl+"/file/file",accept:"image/jpeg,image/png","list-type":"picture-card","before-upload":e.beforeAvatarUpload,"on-preview":e.handlePictureCardPreview,"on-success":function(t,a,i){e.handleSuccess(t,a,i,2)},"on-remove":function(t,a){e.handleRemove(t,a,2)}}},[a("i",{staticClass:"el-icon-plus"})])],1),a("el-form-item",{attrs:{label:"VR"}},[a("el-upload",{attrs:{action:e.baseUrl+"/file/file","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-success":function(t,a,i){e.handleSuccess(t,a,i,3)},"on-remove":function(t,a){e.handleRemove(t,a,3)}}},[a("i",{staticClass:"el-icon-plus"})])],1),a("el-form-item",{attrs:{label:"房源视频"}},[a("el-upload",{attrs:{action:e.baseUrl+"/file/file",accept:"video/mp4","list-type":"picture-card","before-upload":e.beforeVideoUpload,"on-preview":e.handlePictureCardPreview,"on-success":function(t,a,i){e.handleSuccess(t,a,i,4)},"on-remove":function(t,a){e.handleRemove(t,a,4)}}},[a("i",{staticClass:"el-icon-plus"})])],1)],1),a("div",{staticStyle:{"text-align":"center",padding:"40px 0"}},[a("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.saveAndComplete}},[e._v("保存完成")])],1)],1)},n=[],s=(a("ac6a"),a("f803")),l={data:function(){return{baseUrl:"http://8.130.26.25:7005",dialogImageUrl:"",dialogVisible:!1,type1:[],type2:[],type3:[],type4:[]}},methods:{handleRemove:function(e,t,a){switch(a){case 1:this.type1=t;break;case 2:this.type2=t;break;case 3:this.type3=t;break;case 4:this.type4=t;break}},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},saveAndComplete:function(){var e=this,t=[];console.log(this.type1),console.log(this.type2),console.log(this.type3),console.log(this.type4),this.type1.forEach(function(e){t.push({url:e.response.data.url,resType:2})}),this.type2.forEach(function(e){t.push({url:e.response.data.url,resType:3})}),this.type3.forEach(function(e){t.push({url:e.response.data.url,resType:1})}),this.type4.forEach(function(e){t.push({url:e.response.data.url,resType:4})}),Object(s["g"])(this.$route.query.houseId,t).then(function(t){0===t.code?e.$router.push("/house/addHistory"):alert(t.msg)})},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<10;return t||this.$message.error("上传的图片只能是 JPG或者 png 格式!"),a||this.$message.error("上传图片大小不能超过 2MB!"),t&&a},beforeVideoUpload:function(e){var t="video/mp4"===e.type,a=e.size/1024/1024<5;return t||this.$message.error("上传的图片只能是 JPG或者 png 格式!"),a||this.$message.error("上传的视频大小不能超过 5MB!"),t&&a},handleSuccess:function(e,t,a,i){switch(i){case 1:this.type1=a;break;case 2:this.type2=a;break;case 3:this.type3=a;break;case 4:this.type4=a;break}}}},o=l,r=a("2877"),c=Object(r["a"])(o,i,n,!1,null,null,null);t["default"]=c.exports},d408:function(e,t,a){}}]);